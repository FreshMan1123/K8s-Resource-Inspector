# K8s-Resource-Inspector

## 项目简介

K8s-Resource-Inspector 是一个专注于 Kubernetes 资源配置审计、合规检查和最佳实践验证的多集群资源巡检工具。它能够帮助 DevOps 团队和平台工程师快速识别集群中的配置问题、安全风险和潜在的性能瓶颈，确保集群资源符合企业标准和最佳实践。

## 核心功能

- **多集群管理**：统一管理和巡检多个 Kubernetes 集群
- **配置审计**：检查资源配置是否符合企业标准和最佳实践
- **合规性检查**：验证集群是否符合行业标准（如 CIS 基准）
- **资源优化**：识别资源浪费和提供优化建议
- **灵活报告**：支持多种报告格式和输出方式
- **自动化集成**：支持与 CI/CD 流程集成，实现自动化巡检

## 与监控系统的区别

与 Prometheus 等监控系统不同，K8s-Resource-Inspector 专注于：

- **配置审计**而非运行时指标监控
- **最佳实践验证**而非性能数据收集
- **定期巡检报告**而非实时监控告警
- **多集群配置一致性**检查

## 项目结构

项目采用模块化设计，清晰划分功能边界：

```
code/
├── cmd/                      # 命令行入口点
│   └── inspector/            # 主程序入口
│       ├── main.go           # 程序主入口
│       ├── resource.go       # 资源管理命令
│       ├── cluster.go        # 集群管理命令
│       └── resource/         # 资源相关子命令
│           ├── get.go        # 获取资源命令
│           ├── namespace.go  # 命名空间命令
│           └── node.go       # 节点检查命令
├── internal/                 # 内部实现代码(不对外暴露)
│   ├── cluster/              # 集群管理相关
│   │   └── client.go         # 集群客户端
│   ├── kubeconfig/           # kubeconfig管理
│   │   └── manager.go        # 配置文件管理器
│   ├── collector/            # 数据收集层
│   │   ├── node.go           # 节点数据收集
│   │   └── pod.go            # Pod数据收集(计划)
│   ├── rules/                # 规则引擎
│   │   ├── engine.go         # 规则执行引擎
│   │   ├── loader.go         # 规则加载器
│   │   └── types.go          # 规则类型定义
│   ├── analyzer/             # 分析器层
│   │   ├── report.go         # 报告生成器
│   │   ├── node/             # 节点资源分析
│   │   │   └── analyzer.go   # 节点分析器
│   │   └── pod/              # Pod资源分析(计划)
│   └── models/               # 数据模型定义
│       └── node.go           # 节点数据模型
├── configs/                  # 配置文件
│   └── rules/                # 规则定义文件
│       └── node.yaml         # 节点规则
└── pkg/                      # 可供外部使用的包(预留)
```

### 模块说明

#### cmd - 命令行界面
包含所有命令行入口点，使用Cobra框架构建CLI界面。负责参数解析、帮助信息展示和调用内部功能模块。

#### internal - 内部实现
不对外暴露的内部实现代码，包含核心业务逻辑：

- **collector**: 数据收集层，负责从Kubernetes集群收集资源指标和状态
- **rules**: 规则引擎，负责加载、解析和评估配置规则
- **analyzer**: 分析器，将收集的数据与规则进行评估，生成分析报告
- **cluster**: 处理集群连接、认证和API调用
- **kubeconfig**: 管理kubeconfig文件的读写和上下文切换
- **models**: 定义数据结构和检查结果模型

#### configs - 配置文件
存放可由用户自定义的配置文件：
- **rules**: 以YAML格式定义的检查规则，非开发人员也可以编辑

#### pkg - 公共包
可能被其他项目引用的公共功能。目前为预留目录，随项目发展逐步扩充。

## 迭代规划

### 迭代 v0.1：基础框架（2周）

**主要目标**：建立基础框架，实现单集群连接和基本资源检查

**具体任务**：
1. 项目结构搭建
2. 单集群连接实现
3. 获取基本资源（Pod、Deployment等）
4. 实现简单检查逻辑

**交付物**：可运行的CLI工具，能连接集群并列出资源状态

### 迭代 v0.2：规则引擎（2周）

**主要目标**：构建基于YAML的灵活规则引擎，实现基础报告生成

**具体任务**：
1. 基于YAML的规则引擎设计与实现
2. 可配置规则集的加载与评估
3. 多格式报告生成（表格、JSON、YAML）
4. 分层架构（收集器-规则引擎-分析器）实现

**交付物**：支持外部可配置规则的巡检工具，能生成多格式报告

### 迭代 v0.3：多集群支持（2周）

**主要目标**：扩展为多集群巡检工具，增强报告功能

**具体任务**：
1. 多集群管理实现
2. 并行巡检能力
3. JSON/Markdown报告格式支持
4. 资源过滤功能

**交付物**：支持多集群的巡检工具，具备多格式报告能力

### 迭代 v0.4：容器化与自动化（2周）

**主要目标**：实现容器化部署和自动化流程

**具体任务**：
1. Dockerfile编写（多阶段构建）
2. Kubernetes部署清单创建
3. GitHub Actions CI流程设置
4. 定时巡检任务实现

**交付物**：容器化的巡检工具，完整的CI流程，支持定时巡检

### 迭代 v0.5：集成与扩展（3周）

**主要目标**：增加企业级功能，提升用户体验

**具体任务**：
1. 告警集成（Slack、邮件等）
2. 历史报告存储与对比
3. 更多资源类型支持
4. 性能优化与扩展性提升

**交付物**：企业级巡检系统，支持告警和历史对比

## 技术栈

- **语言**：Go
- **K8s交互**：client-go、metrics-client
- **CLI框架**：cobra、viper
- **规则配置**：YAML
- **容器化**：Docker
- **CI/CD**：GitHub Actions
- **部署**：Kubernetes

## 详细文档

- [架构设计文档](docs/architecture.md) - 详细的架构说明和规则配置指南

## 使用场景

- **定期安全审计**：检查所有集群是否存在安全风险
- **上线前检查**：确保新应用配置符合最佳实践
- **合规性报告**：为安全团队生成定期合规报告
- **配置标准化**：确保多集群环境中资源配置的一致性
- **问题根因分析**：快速检查资源配置是否符合预期

## 后续规划

- **Web界面**：提供图形化操作界面
- **插件系统**：支持自定义规则和报告格式
- **高级分析**：基于历史数据的趋势分析
- **自动修复**：对于常见问题提供自动修复能力 



天1：项目初始化与环境搭建
上午：创建项目结构、设置Go模块依赖
下午：实现安全的kubeconfig管理
晚上：搭建本地测试环境(Kind集群)
天2：核心连接与资源获取
上午：实现集群客户端模块
下午：开发基础资源获取功能(Pod, Deployment)
晚上：扩展资源获取(Service, ConfigMap, Secret)
天3：命令行界面与资源检查
上午：创建CLI框架(使用cobra)
下午：实现资源列表与过滤功能
晚上：开发资源健康状态检查
天4：规则引擎基础
上午：设计规则引擎架构
下午：实现规则评估系统
晚上：添加基础内置规则集
天5：多集群支持与并行处理
上午：实现多集群配置管理
下午：开发集群切换功能
晚上：添加并行巡检能力
天6-7：报告系统与测试
上午：开发多格式报告生成器(文本、JSON)
下午：实现报告模板系统
晚上：编写单元测试与集成测试
第二周：高级功能与企业级特性
天8：高级规则与合规检查
上午：实现CIS基准检查规则
下午：添加最佳实践验证规则
晚上：开发自定义规则导入功能
天9：资源优化建议
上午：实现资源请求/限制分析
下午：开发资源使用效率检查
晚上：添加优化建议生成功能
天10：历史数据与比较
上午：设计历史数据存储系统
下午：实现报告存储与检索
晚上：开发历史比较功能
天11：告警集成
上午：设计告警系统架构
下午：实现Slack/Email通知
晚上：添加告警条件配置
天12：容器化与自动化
上午：编写Dockerfile(多阶段构建)
下午：创建Kubernetes部署清单
晚上：设置GitHub Actions CI流程
天13：文档与示例
上午：编写详细使用文档
下午：创建教程与示例
晚上：完善API文档
天14：性能优化与发布准备
上午：进行性能测试与优化
下午：修复发现的问题
晚上：准备v0.1版本发布 m